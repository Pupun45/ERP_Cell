<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - ERP Cell</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ›ï¸</text></svg>">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
      min-height: 100vh; 
      padding: 20px;
    }
    .container { max-width: 1400px; margin: 0 auto; }

    /* ğŸ”¥ NAVBAR */
    .navbar {
      background: rgba(255,255,255,0.95); backdrop-filter: blur(20px);
      border-radius: 16px; padding: 0; margin-bottom: 2rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    .btn-warning{
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    background-color: #5593f5;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.3s;
    }
    .top-bar {
      display: flex; justify-content: space-between; align-items: center;
      padding: 20px 24px; background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      border-radius: 16px 16px 0 0; color: white;
    }
    .tab-nav {
      display: flex; background: #f8fafc; border-radius: 0 0 16px 16px;
      padding: 0; overflow-x: auto;
    }
    .tab-btn {
      flex: 1; padding: 16px 20px; border: none; background: none;
      font-size: 15px; font-weight: 500; color: #6b7280;
      cursor: pointer; border-bottom: 3px solid transparent;
      transition: all 0.3s ease; white-space: nowrap;
    }
    .tab-btn.active {
      color: #3b82f6; background: white; border-bottom-color: #3b82f6;
      box-shadow: 0 -2px 10px rgba(59,130,246,0.1);
    }
    .tab-btn:hover { color: #2563eb; background: #f1f5f9; }

    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .tab-panels {
      background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
      border-radius: 16px; padding: 24px; margin-bottom: 2rem;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }

    .stats-grid { 
      display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
      gap: 20px; margin-bottom: 2rem; 
    }
    .stat-card {
      background: linear-gradient(135deg, #10b981, #059669); color: white; 
      padding: 24px; border-radius: 16px; text-align: center;
      position: relative; overflow: hidden; cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .stat-card:hover {
      transform: translateY(-5px); box-shadow: 0 20px 40px rgba(16,185,129,0.3);
    }
    .stat-card:nth-child(2) { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
    .stat-card:nth-child(2):hover { box-shadow: 0 20px 40px rgba(59,130,246,0.3); }
    .stat-card:nth-child(3) { background: linear-gradient(135deg, #f59e0b, #d97706); }
    .stat-card:nth-child(3):hover { box-shadow: 0 20px 40px rgba(245,158,11,0.3); }
    .stat-card:nth-child(4) { background: linear-gradient(135deg, #ef4444, #dc2626); }
    .stat-card:nth-child(4):hover { box-shadow: 0 20px 40px rgba(239,68,68,0.3); }
    .stat-card.loading::after {
      content: ''; position: absolute; top: 10px; right: 10px;
      width: 20px; height: 20px; border: 2px solid rgba(255,255,255,0.3);
      border-top: 2px solid white; border-radius: 50%; animation: spin 1s linear infinite;
    }
    .stat-number { font-size: 2.8em; font-weight: 700; margin-bottom: 8px; }
    .stat-label { font-size: 16px; opacity: 0.95; font-weight: 500; }
    .stat-trend { font-size: 14px; opacity: 0.8; margin-top: 4px; }

    .activity-card {
      background: linear-gradient(135deg, #f8fafc, #f1f5f9);
      border-left: 4px solid #3b82f6; padding: 20px; border-radius: 12px;
    }

    .btn-primary, .btn-secondary, .btn-danger { 
      border: none; padding: 8px 16px; border-radius: 6px; 
      cursor: pointer; font-weight: 500; transition: all 0.3s;
    }
    .btn-primary { background: #3b82f6; color: white; }
    .btn-primary:hover { background: #2563eb; transform: translateY(-2px); }
    .btn:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
    
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; margin-bottom: 2rem; }
    .card { 
      background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); 
      padding: 24px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
    }
    .card h3 { margin-bottom: 16px; color: #1f2937; border-bottom: 2px solid #e5e7eb; padding-bottom: 8px; }
    
    input, select { 
      width: 100%; padding: 12px; margin-bottom: 12px; border: 2px solid #e5e7eb; 
      border-radius: 8px; font-size: 16px; transition: all 0.3s; 
    }
    input:focus, select:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102,126,234,0.1); }
    
    .table-container { overflow-x: auto; margin-top: 16px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid #e5e7eb; }
    th { background: #f8fafc; font-weight: 600; color: #374151; }
    tr:hover { background: #f1f5f9; }

    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    @media (max-width: 768px) { 
      .grid, .stats-grid { grid-template-columns: 1fr; } 
      .tab-nav { flex-direction: column; }
      .tab-btn { border-bottom: none; border-right: 3px solid transparent; }
      .tab-btn.active { border-right-color: #3b82f6; }
    }

    label { display: block; font-weight: 500; color: #374151; margin: 8px 0 4px 0; font-size: 14px; }
    input[required] { border-left: 3px solid #3b82f6; }
    .form-actions { display: flex; gap: 10px; align-items: center; }
    .subjects-preview {
      background: linear-gradient(135deg, #f0fdf4, #dcfce7); padding: 12px; 
      border-radius: 8px; margin: 10px 0; border-left: 4px solid #10b981; 
      font-size: 14px; min-height: 24px; transition: all 0.3s ease;
    }
    .semester-select { margin: 8px 0; }
  </style>
</head>
<body>
  <div class="container">
    <div class="navbar">
      <div class="top-bar">
        <h1>Admin Dashboard - ERP Cell</h1>
        <div style="display: flex; gap: 10px; align-items: center;">
          <span id="profileName" style="font-weight: 500;"></span>
          <button id="logoutBtn" class="btn-danger" style="padding: 10px 20px; font-weight: 600;">Logout</button>
        </div>
      </div>
      <div class="tab-nav">
        <button class="tab-btn active" data-tab="home">ğŸ  Home</button>
        <button class="tab-btn" data-tab="subjects">ğŸ“š Subjects</button>
        <button class="tab-btn" data-tab="teachers">ğŸ‘¨â€ğŸ« Teachers</button>
        <button class="tab-btn" data-tab="students">ğŸ‘¨â€ğŸ“ Students</button>
        <button class="tab-btn" data-tab="fees">ğŸ’° Fees</button>
      </div>
    </div>
    <div id="home" class="tab-content active">
      <div class="tab-panels">
        <div class="stats-grid">
          <div class="stat-card loading" data-type="students">
            <div class="stat-number" id="totalStudents">0</div>
            <div class="stat-label">Total Students</div>
            <div class="stat-trend" id="studentsTrend">Loading...</div>
          </div>
          <div class="stat-card loading" data-type="teachers">
            <div class="stat-number" id="totalTeachers">0</div>
            <div class="stat-label">Total Teachers</div>
            <div class="stat-trend" id="teachersTrend">Loading...</div>
          </div>
          <div class="stat-card loading" data-type="subjects">
            <div class="stat-number" id="totalSubjects">0</div>
            <div class="stat-label">Total Subjects</div>
            <div class="stat-trend" id="subjectsTrend">Loading...</div>
          </div>
          <div class="stat-card loading" data-type="branches">
            <div class="stat-number" id="totalBranches">0</div>
            <div class="stat-label">Branches</div>
            <div class="stat-trend" id="branchesTrend">Loading...</div>
          </div>
        </div>

        <div class="grid">
          <div class="card" style="grid-column: span 2;">
            <h3> Recent Activity</h3>
            <div id="recentActivity" class="activity-card" style="min-height: 120px;">
              <div style="text-align: center; padding: 40px; color: #718096;">
                <div style="font-size: 16px; margin-bottom: 10px;">â³ Loading recent activity...</div>
                <div class="loading-spinner" style="display: inline-block; width: 24px; height: 24px; border-width: 3px;"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="subjects" class="tab-content">
      <div class="tab-panels">
        <div class="grid">
          <div class="card">
            <h3>ğŸ“š Add New Subjects</h3>
            <form id="createSubjectForm">
              <input id="subjectBranch" placeholder="Branch (e.g., CSE, MBA)" required>
              <select id="subjectSemester" class="semester-select" required>
                <option value="">Select Semester</option>
                <option value="1st">1st Semester</option>
                <option value="2nd">2nd Semester</option>
                <option value="3rd">3rd Semester</option>
                <option value="4th">4th Semester</option>
              </select>
              <input id="subjectNames" placeholder="Subjects: DSA, OS, DBMS" required>
              <div id="subjectPreview" class="subjects-preview">
                <strong>ğŸ“š Subjects:</strong> <span>Enter branch + semester</span>
              </div>
              <button class="btn-primary" type="submit">Add Subjects</button>
            </form>
          </div>
        </div>
        <div class="card">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h3>ğŸ“š Subjects List</h3>
            <button id="refreshSubjectsBtn" class="btn-primary">ğŸ”„ Refresh</button>
          </div>
          <div class="table-container">
            <table><thead><tr><th style="width: 25%;">Branch</th><th style="width: 15%;">Semester</th><th width="35%">Subjects</th><th width="10%">Date</th><th width="25%">Actions</th></tr></thead><tbody id="subjectsTableBody"><tr><td colspan="5" style="text-align: center; color: #718096; padding: 2rem;">Loading subjects...</td></tr></tbody></table>
          </div>
        </div>
      </div>
    </div>

    <div id="teachers" class="tab-content">
      <div class="tab-panels">
        <div class="grid">
          <div class="card">
            <h3>ğŸ‘¨â€ğŸ« Add New Teacher</h3>
            <form id="createTeacherForm">
              <input id="teacherName" placeholder="Full Name" required>
              <input id="teacherEmail" type="email" placeholder="teacher@college.com" required>
              <label>Password <span style="color: #ef4444;">*</span></label>
              <input id="teacherPassword" type="password" placeholder="Enter password" required>
              <select id="teacherBranch" required><option value="">Loading branches...</option></select>
              <select id="teacherSemester" class="semester-select" style="display: none;" required><option value="">Select Semester</option></select>
              <input id="teacherSalary" type="number" placeholder="Salary (â‚¹)" min="0" required>
              <div id="teacherSubjectsPreview" class="subjects-preview"><strong>ğŸ“š Subjects:</strong> <span>Select branch first</span></div>
              <div class="form-actions">
                <button class="btn-primary" type="submit">Create Teacher</button>
                <button type="button" class="btn-secondary" onclick="cancelEdit()">Cancel</button>
              </div>
            </form>
          </div>
        </div>
        <div class="card">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h3>ğŸ‘¨â€ğŸ« Teachers List</h3>
            <button id="refreshTeachersBtn" class="btn-primary">ğŸ”„ Refresh</button>
          </div>
          <div class="table-container">
            <table><thead><tr><th>Name</th><th>Email</th><th>Branch</th><th>Subjects</th><th>Salary</th><th style="width: 20%;">Actions</th></tr></thead><tbody id="teachersTableBody"><tr><td colspan="6" style="text-align: center; color: #718096;">Loading teachers...</td></tr></tbody></table>
          </div>
        </div>
      </div>
    </div>

    <div id="students" class="tab-content">
      <div class="tab-panels">
        <div class="grid">
          <div class="card">
            <h3>ğŸ‘¨â€ğŸ“ Add New Student</h3>
            <form id="createStudentForm">
              <input id="studentName" placeholder="Full Name" required>
              <input id="studentEmail" type="email" placeholder="student@college.com" required>
              <label>Password <span style="color: #ef4444;">*</span></label>
              <input id="studentPassword" type="password" placeholder="Enter password" required>
              <input id="studentRollNo" placeholder="Roll No (CSE23A001)" required>
              <select id="studentBranch" required><option value="">Loading branches...</option></select>
              <select id="studentSemester" class="semester-select" required><option value="">Select Branch First</option></select>
              <div id="subjectsList" class="subjects-preview"><strong>ğŸ“š Subjects:</strong> <span>Select branch + semester</span></div>
              <div class="form-actions">
                <button class="btn-primary" type="submit">Create Student</button>
                <button type="button" class="btn-secondary" onclick="cancelEdit()">Cancel</button>
              </div>
            </form>
          </div>
        </div>
        <div class="card">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h3>ğŸ‘¨â€ğŸ“ Students List</h3>
            <button id="refreshStudentsBtn" class="btn-primary">ğŸ”„ Refresh</button>
          </div>
          <div class="table-container">
            <table><thead><tr><th>Name</th><th>Email</th><th>Roll No</th><th>Branch</th><th>Semester</th><th>Subjects</th><th style="width: 18%;">Actions</th></tr></thead><tbody id="studentsTableBody"><tr><td colspan="7" style="text-align: center; color: #718096;">Loading students...</td></tr></tbody></table>
          </div>
        </div>
      </div>
    </div>

    <div id="fees" class="tab-content">
      <div class="tab-panels">
        <div class="card">
          <h3>ğŸ’° Fees Management</h3>
          <p>Fees module coming soon! </p>
          <div style="text-align: center; padding: 40px; color: #718096;">
            Total Fees Collected: <strong id="totalFeesCollected">â‚¹0</strong>
          </div>
        </div>
      </div>
    </div>

    <div id="message" style="margin-top: 1rem;"></div>
  </div>

  <script src="./js/script.js"></script>

  <script>
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.tab).classList.add('active');
      });
    });

    window.loadDashboardStats = async function() {
      try {
        // Students count
        const studentsRes = await fetch('https://erp-cell.onrender.com/api/students', { credentials: 'include' });
        const students = await studentsRes.json();
        document.getElementById('totalStudents').textContent = students.length || 0;
        document.getElementById('studentsTrend').textContent = students.length > 0 ? `+${students.length} active` : 'No students';

        // Teachers count  
        const teachersRes = await fetch('https://erp-cell.onrender.com/api/teachers', { credentials: 'include' });
        const teachers = await teachersRes.json();
        document.getElementById('totalTeachers').textContent = teachers.length || 0;
        document.getElementById('teachersTrend').textContent = teachers.length > 0 ? `Avg â‚¹${Math.round(teachers.reduce((sum, t) => sum + (t.salary||0), 0)/teachers.length)}/mo` : 'No teachers';

        // Subjects + Branches
        const subjectsRes = await fetch('https://erp-cell.onrender.com/api/subjects', { credentials: 'include' });
        const subjects = await subjectsRes.json();
        document.getElementById('totalSubjects').textContent = subjects.reduce((sum, s) => sum + (s.subjects?.length||0), 0) || 0;
        const branches = [...new Set(subjects.map(s => s.branch))];
        document.getElementById('totalBranches').textContent = branches.length || 0;
        document.getElementById('subjectsTrend').textContent = branches.length > 0 ? `${branches.length} branches` : 'No subjects';

        // Remove loading states
        document.querySelectorAll('.stat-card.loading').forEach(card => card.classList.remove('loading'));

        // Recent activity 
        document.getElementById('recentActivity').innerHTML = `
          <div style="display: flex; flex-direction: column; gap: 12px;">
            <div style="display: flex; align-items: center; gap: 12px;">
              <div style="width: 8px; height: 8px; background: #10b981; border-radius: 50%;"></div>
              <span> Loaded ${students.length} students</span>
              <span style="margin-left: auto; font-size: 12px; color: #6b7280;">${new Date().toLocaleTimeString()}</span>
            </div>
            <div style="display: flex; align-items: center; gap: 12px;">
              <div style="width: 8px; height: 8px; background: #3b82f6; border-radius: 50%;"></div>
              <span> Loaded ${teachers.length} teachers</span>
              <span style="margin-left: auto; font-size: 12px; color: #6b7280;">${new Date().toLocaleTimeString()}</span>
            </div>
            <div style="display: flex; align-items: center; gap: 12px;">
              <div style="width: 8px; height: 8px; background: #f59e0b; border-radius: 50%;"></div>
              <span> ${branches.length} branches active</span>
              <span style="margin-left: auto; font-size: 12px; color: #6b7280;">${new Date().toLocaleTimeString()}</span>
            </div>
          </div>
        `;
      } catch (err) {
        console.error('Dashboard stats error:', err);
        document.getElementById('recentActivity').innerHTML = '<div style="text-align: center; padding: 40px; color: #ef4444;"> Could not load live stats</div>';
      }
    };

    window.addEventListener('load', () => {
      setTimeout(loadDashboardStats, 500);
    });
  </script>
</body>
</html>
